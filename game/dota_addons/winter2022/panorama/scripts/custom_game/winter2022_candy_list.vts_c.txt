"use strict";
/// <reference path="../winter2022.d.ts" />
/// <reference path="util.ts" />
/// <reference path="winter2022_shared.ts" />
const g_CandyState = SubscribeAllTableValues("candy_list", UpdateCandyList);
CustomNetTables.SubscribeNetTableListener("globals", UpdateCandyList);
let g_CandyPanels = {};
function Init() {
    $.GetContextPanel().RemoveAndDeleteChildren();
    g_CandyPanels = {};
    TrackAltPressed($.GetContextPanel());
    const nLocalTeam = Players.GetTeam(Players.GetLocalPlayer());
    $.GetContextPanel().SetHasClass("Spectating", nLocalTeam !== DOTATeam_t.DOTA_TEAM_BADGUYS && nLocalTeam !== DOTATeam_t.DOTA_TEAM_GOODGUYS);
    UpdateCandyList();
}
$.Schedule(1.0, Init);
function UpdateCandyList() {
    const nLocalTeam = Players.GetTeam(Players.GetLocalPlayer());
    const bLocalIsInGame = nLocalTeam === DOTATeam_t.DOTA_TEAM_BADGUYS || nLocalTeam === DOTATeam_t.DOTA_TEAM_GOODGUYS;
    const candyValues = {};
    Object.values(g_CandyState).forEach(state => {
        if (!state)
            return;
        const nPlayerID = Entities.GetPlayerOwnerID(state.entity_index);
        if (Players.IsValidPlayerID(nPlayerID))
            candyValues[nPlayerID] = (candyValues[nPlayerID] || 0) + state.candy_count;
    });
    GetValidPlayerIDs().forEach(nPlayerID => {
        const nCandyCount = candyValues[nPlayerID] || 0;
        const bShowCandy = nCandyCount !== 0 && (!bLocalIsInGame || nLocalTeam === Players.GetTeam(nPlayerID));
        if (bShowCandy) {
            const candyPanel = g_CandyPanels[nPlayerID] || CreatePlayerCandyPanel(nPlayerID);
            if (!candyPanel)
                return;
            candyPanel.SetDialogVariableInt("candy_count", nCandyCount);
            candyPanel.SetHasClass("Hidden", false);
        }
        else {
            const candyPanel = g_CandyPanels[nPlayerID];
            if (candyPanel) {
                candyPanel.SetDialogVariableInt("candy_count", 0);
                candyPanel.SetHasClass("Hidden", true);
            }
        }
    });
}
function CreatePlayerCandyPanel(nPlayerID) {
    if (g_CandyPanels[nPlayerID])
        return g_CandyPanels[nPlayerID];
    const bIsRadiant = Players.GetTeam(nPlayerID) == DOTATeam_t.DOTA_TEAM_GOODGUYS;
    const panelId = `${bIsRadiant ? "Radiant" : "Dire"}Player${nPlayerID}`;
    const hud = $.GetContextPanel().FindAncestor("HUDElements");
    if (!hud)
        return null;
    const playerPanel = hud.FindChildTraverse(panelId);
    if (!playerPanel)
        return null;
    const playerContainer = playerPanel.FindChildTraverse("SlantedContainerPanel");
    if (!playerContainer)
        return null;
    const playerRect = GetPanelRect(playerContainer);
    const candyPanel = $.CreatePanel("Panel", $.GetContextPanel(), `Player${nPlayerID}Candy`);
    candyPanel.BLoadLayoutSnippet("PlayerCandy");
    candyPanel.SwitchClass("team", bIsRadiant ? "PlayerCandyRadiant" : "PlayerCandyDire");
    candyPanel.SetPositionInPixels(playerRect.x, playerRect.height, 0);
    g_CandyPanels[nPlayerID] = candyPanel;
    return candyPanel;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ludGVyMjAyMl9jYW5keV9saXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vZG90YV9hZGRvbnMvd2ludGVyMjAyMi9wYW5vcmFtYS9zY3JpcHRzL2N1c3RvbV9nYW1lL3dpbnRlcjIwMjJfY2FuZHlfbGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsMkNBQTJDO0FBQzNDLGdDQUFnQztBQUNoQyw2Q0FBNkM7QUFHN0MsTUFBTSxZQUFZLEdBQUcsdUJBQXVCLENBQWdCLFlBQVksRUFBRSxlQUFlLENBQUUsQ0FBQztBQUM1RixlQUFlLENBQUMseUJBQXlCLENBQUUsU0FBUyxFQUFFLGVBQWUsQ0FBRSxDQUFDO0FBRXhFLElBQUksYUFBYSxHQUF3QixFQUFFLENBQUM7QUFDNUMsU0FBUyxJQUFJO0lBRVQsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFDLHVCQUF1QixFQUFFLENBQUM7SUFDOUMsYUFBYSxHQUFHLEVBQUUsQ0FBQTtJQUVsQixlQUFlLENBQUUsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFFLENBQUM7SUFFdkMsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBRSxPQUFPLENBQUMsY0FBYyxFQUFFLENBQUUsQ0FBQztJQUMvRCxDQUFDLENBQUMsZUFBZSxFQUFFLENBQUMsV0FBVyxDQUFFLFlBQVksRUFBRSxVQUFVLEtBQUssVUFBVSxDQUFDLGlCQUFpQixJQUFJLFVBQVUsS0FBSyxVQUFVLENBQUMsa0JBQWtCLENBQUUsQ0FBQztJQUU3SSxlQUFlLEVBQUUsQ0FBQztBQUN0QixDQUFDO0FBQ0QsQ0FBQyxDQUFDLFFBQVEsQ0FBRSxHQUFHLEVBQUUsSUFBSSxDQUFFLENBQUM7QUFFeEIsU0FBUyxlQUFlO0lBRXBCLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUUsT0FBTyxDQUFDLGNBQWMsRUFBRSxDQUFFLENBQUM7SUFDL0QsTUFBTSxjQUFjLEdBQUcsVUFBVSxL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