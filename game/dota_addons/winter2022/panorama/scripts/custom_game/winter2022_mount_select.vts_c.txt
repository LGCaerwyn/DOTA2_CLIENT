"use strict";
/// <reference path="../../../../../dota/panorama/scripts/dota.d.ts" />
/// <reference path="winter2022_shared.ts" />
const mountChoices = SubscribeAllTableValues("mount_choices", UpdateMountChoice);
function ChooseMount(sChoice) {
    GameEvents.SendCustomGameEventToServer("mount_choice", { Choice: sChoice });
    FloatIcon(sChoice);
}
let g_bMountSelectIsOpen = false;
function UpdateMountChoice() {
    const nPlayerId = Players.GetLocalPlayer();
    const loadoutChoices = Object.values(mountChoices[nPlayerId] || {});
    if (loadoutChoices.length === 0) {
        if (g_bMountSelectIsOpen) {
            g_bMountSelectIsOpen = false;
            Game.EmitSound("PenguinLoadout.Claim");
            $("#PenguinLoadoutContainer").RemoveClass("Visible");
            $("#PenguinLoadoutBackground").RemoveClass("Visible");
        }
        return;
    }
    const pList = $("#PenguinLoadoutList");
    pList.RemoveAndDeleteChildren();
    for (const sChoice of loadoutChoices) {
        const pItem = $.CreatePanel("Panel", pList, `PenguinLoadoutItem_${sChoice}`);
        pItem.BLoadLayoutSnippet("PenguinLoadoutItem");
        pItem.SwitchClass("Choice", sChoice);
        pItem.SetDialogVariableLocString("loadout_item_name", `#DOTA_HUD_mount_${sChoice}`);
        pItem.SetDialogVariableLocString("loadout_item_description", `#DOTA_HUD_mount_${sChoice}_description`);
        pItem.SetPanelEvent('onactivate', () => ChooseMount(sChoice));
    }
    if (!g_bMountSelectIsOpen) {
        g_bMountSelectIsOpen = true;
        $.Schedule(1.0, () => {
            Game.EmitSound("PenguinLoadout.Claim");
            $("#PenguinLoadoutContainer").AddClass("Visible");
            $("#PenguinLoadoutBackground").AddClass("Visible");
        });
    }
}
$.Schedule(0.5, UpdateMountChoice);
function FloatIcon(sChoice) {
    const pLoadoutItem = $(`#PenguinLoadoutItem_${sChoice}`);
    const pLoadoutIcon = pLoadoutItem.FindChildInLayoutFile("PenguinLoadoutIcon");
    const startRect = ObjectToMap(GetPanelRect(pLoadoutIcon));
    const pHud = $.GetContextPanel().FindAncestor("HUDElements");
    const pLowerHud = pHud.FindChild("lower_hud");
    const pSecondaryAbilities = pLowerHud.FindChildTraverse("SecondaryAbilityContainer");
    const pTartiaryAbilities = pSecondaryAbilities.FindChildTraverse("TertiaryAbilitiesBar");
    const pMountAbility = pTartiaryAbilities.FindChildTraverse("ConsumableAbility0");
    const endRect = ObjectToMap(GetPanelRect(pMountAbility));
    const pFloatingIcon = $("#PenguinLoadoutFloatingIcon");
    pFloatingIcon.SwitchClass("choice", sChoice);
    pFloatingIcon.RemoveClass("Hidden");
    function MoveIcon(curRect) {
        pFloatingIcon.SetPositionInPixels(curRect.get("x"), curRect.get("y"), 0);
        pFloatingIcon.style.height = curRect.get("height") + "px";
        pFloatingIcon.style.width = curRect.get("width") + "px";
    }
    InterpolateEveryFrame(0.6, startRect, endRect, MoveIcon, () => pFloatingIcon.AddClass("Hidden"));
}
function DebugFloatIcon() {
    const nPlayerId = Players.GetLocalPlayer();
    const loadoutChoices = Object.values(mountChoices[nPlayerId] || {});
    if (loadoutChoices.length > 0) {
        const sChoice = loadoutChoices[Math.floor(loadoutChoices.length * Math.random())];
        $.Msg(`DebugFloatIcon ${sChoice}`);
        FloatIcon(sChoice);
    }
    $.Schedule(3, DebugFloatIcon);
}
// $.Schedule( 3, DebugFloatIcon );
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ludGVyMjAyMl9tb3VudF9zZWxlY3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3aW50ZXIyMDIyX21vdW50X3NlbGVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsdUVBQXVFO0FBQ3ZFLDZDQUE2QztBQUc3QyxNQUFNLFlBQVksR0FBRyx1QkFBdUIsQ0FBa0IsZUFBZSxFQUFFLGlCQUFpQixDQUFFLENBQUM7QUFFbkcsU0FBUyxXQUFXLENBQUUsT0FBZTtJQUVqQyxVQUFVLENBQUMsMkJBQTJCLENBQUUsY0FBYyxFQUFFLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxDQUFFLENBQUM7SUFDOUUsU0FBUyxDQUFFLE9BQU8sQ0FBRSxDQUFDO0FBQ3pCLENBQUM7QUFFRCxJQUFJLG9CQUFvQixHQUFHLEtBQUssQ0FBQztBQUNqQyxTQUFTLGlCQUFpQjtJQUV0QixNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDM0MsTUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBRSxZQUFZLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFFLENBQUM7SUFDdEUsSUFBSyxjQUFjLENBQUMsTUFBTSxLQUFLLENBQUMsRUFDaEM7UUFDSSxJQUFLLG9CQUFvQixFQUN6QjtZQUNJLG9CQUFvQixHQUFHLEtBQUssQ0FBQztZQUM3QixJQUFJLENBQUMsU0FBUyxDQUFFLHNCQUFzQixDQUFFLENBQUM7WUFDekMsQ0FBQyxDQUFFLDBCQUEwQixDQUFHLENBQUMsV0FBVyxDQUFFLFNBQVMsQ0FBRSxDQUFDO1lBQzFELENBQUMsQ0FBRSwyQkFBMkIsQ0FBRyxDQUFDLFdBQVcsQ0FBRSxTQUFTLENBQUUsQ0FBQztTQUM5RDtRQUNELE9BQU87S0FDVjtJQUVELE1BQU0sS0FBSyxHQUFHLENBQUMsQ0FBRSxxQkFBcUIsQ0FBRyxDQUFDO0lBQzFDLEtBQUssQ0FBQyx1QkFBdUIsRUFBRSxDQUFDO0lBQ2hDLEtBQU0sTUFBTSxPQUFPLElBQUksY0FBYyxFQUNyQztRQUNJLE1BQU0sS0FBSyxHQUFHLENBQUMsQ0FBQyxXQUFXLENBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxzQkFBc0IsT0FBTyxFQUFFLENBQUUsQ0FBQztRQUMvRSxLQUFLLENBQUMsa0JBQWtCLENBQUUsb0JBQW9CLENBQUUsQ0FBQztRQUNqRCxLQUFLLENBQUMsV0FBVyxDQUFFLFFBQVEsRUFBRSxPQUFPLENBQUUsQ0FBQztRQUN2QyxLQUFLLENBQUMsMEJBQTBCLENBQUUsbUJBQW1CLEVBQUUsbUJBQW1CLE9BQU8sRUFBRSxDQUFFLENBQUM7UUFDdEYsS0FBSyxDQUFDLDBCQUEwQixDQUFFLDBCQUEwQixFQUFFLG1CQUFtQixPQUFPLGNBQWMsQ0FBRSxDQUFDO1FBQ3pHLEtBQUssQ0FBQyxhQUFhLENBQUUsWUFBWSxFQUFFLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBRSxPQUFPLENBQUUsQ0FBRSxDQUFDO0tBQ3JFO0lBRUQsSUFBSyxDQUFDLG9CQUFvQixFQUMxQjtRQUNJLG9CQUFvQixHQUFHLElBQUksQ0FBQztRQUM1QixDQUFDLENBQUMsUUFBUSxDQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUU7WUFFbEIsSUFBSSxDQUFDLFNBQVMsQ0FBRSxzQkFBc0IsQ0FBRSxDQUFDO1lBQ3pDLENBQUMsQ0FBRSwwQkFBMEIsQ0FBRyxDQUFDLFFBQVEsQ0FBRSxTQUFTLENBQUUsQ0FBQztZQUN2RCxDQUFDLENBQUUsMkJBQTJCLENBQUcsQ0FBQyxRQUFRLENBQUUsU0FBUyxDQUFFLENBQUM7UUFDNUQsQ0FBQyxDQUFFLENBQUM7S0FDUDtBQUNMLENBQUM7QUFDRCxDQUFDLENBQUMsUUFBUSxDQUFFLEdBQUcsRUFBRSxpQkFBaUIsQ0FBRSxDQUFDO0FBRXJDLFNBQVMsU0FBUyxDQUFFLE9BQWU7SUFFL0IsTUFBTSxZQUFZLEdBQUcsQ0FBQyxDQUFFLHVCQUF1QixPQUFPLEVBQUUsQ0FBRyxDQUFDO0lBQzVELE1BQU0sWUFBWSxHQUFHLFlBQVksQ0FBQyxxQkFBcUIsQ0FBRSxvQkFBb0IsQ0FBRSxDQUFDO0lBQ2hGLE1BQU0sU0FBUyxHQUFHLFdBQVcsQ0FBVSxZQUFZLENBQUUsWUFBWSxDQUFFLENBQUUsQ0FBQztJQUV0RSxNQUFNLElBQUksR0FBRyxDQUFDLENBQUMsZUFBZSxFQUFFLENBQUMsWUFBWSxDQUFFLGFBQWEsQ0FBRyxDQUFDO0lBQ2hFLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUUsV0FBVyxDQUFHLENBQUM7SUFDakQsTUFBTSxtQkFBbUIsR0FBRyxTQUFTLENBQUMsaUJBQWlCLENBQUUsMkJBQTJCLENBQUUsQ0FBQztJQUN2RixNQUFNLGtCQUFrQixHQUFHLG1CQUFtQixDQUFDLGlCQUFpQixDQUFFLHNCQUFzQixDQUFFLENBQUM7SUFDM0YsTUFBTSxhQUFhLEdBQUcsa0JBQWtCLENBQUMsaUJBQWlCLENBQUUsb0JBQW9CLENBQUUsQ0FBQztJQUNuRixNQUFNLE9BQU8sR0FBRyxXQUFXLENBQVUsWUFBWSxDQUFFLGFBQWEsQ0FBRSxDQUFFLENBQUM7SUFFckUsTUFBTSxhQUFhLEdBQUcsQ0FBQyxDQUFFLDZCQUE2QixDQUFHLENBQUM7SUFDMUQsYUFBYSxDQUFDLFdBQVcsQ0FBRSxRQUFRLEVBQUUsT0FBTyxDQUFFLENBQUM7SUFDL0MsYUFBYSxDQUFDLFdBQVcsQ0FBRSxRQUFRLENBQUUsQ0FBQztJQUV0QyxTQUFTLFFBQVEsQ0FBRSxPQUE0QjtRQUUzQyxhQUFhLENBQUMsbUJBQW1CLENBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBRSxHQUFHLENBQUcsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFFLEdBQUcsQ0FBRyxFQUFFLENBQUMsQ0FBRSxDQUFDO1FBQ2pGLGFBQWEsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUUsUUFBUSxDQUFHLEdBQUcsSUFBSSxDQUFDO1FBQzdELGFBQWEsQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUUsT0FBTyxDQUFHLEdBQUcsSUFBSSxDQUFDO0lBQy9ELENBQUM7SUFFRCxxQkFBcUIsQ0FBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBRSxRQUFRLENBQUUsQ0FBRSxDQUFDO0FBQ3pHLENBQUM7QUFFRCxTQUFTLGNBQWM7SUFFbkIsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQzNDLE1BQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUUsWUFBWSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBRSxDQUFDO0lBQ3RFLElBQUssY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQzlCO1FBQ0ksTUFBTSxPQUFPLEdBQUcsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUUsY0FBYyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUUsQ0FBQyxDQUFDO1FBQ3BGLENBQUMsQ0FBQyxHQUFHLENBQUUsa0JBQWtCLE9BQU8sRUFBRSxDQUFFLENBQUM7UUFDckMsU0FBUyxDQUFFLE9BQU8sQ0FBRSxDQUFDO0tBQ3hCO0lBQ0QsQ0FBQyxDQUFDLFFBQVEsQ0FBRSxDQUFDLEVBQUUsY0FBYyxDQUFFLENBQUM7QUFDcEMsQ0FBQztBQUNELG1DQUFtQyJ9