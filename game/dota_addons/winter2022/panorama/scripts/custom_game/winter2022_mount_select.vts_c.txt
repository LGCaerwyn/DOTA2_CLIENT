"use strict";
/// <reference path="../winter2022.d.ts" />
/// <reference path="winter2022_shared.ts" />
const mountChoices = SubscribeAllTableValues("mount_choices", UpdateMountChoice);
function ChooseMount(sChoice) {
    GameEvents.SendCustomGameEventToServer("mount_choice", { Choice: sChoice });
    FloatIcon(sChoice);
}
let g_bMountSelectIsOpen = false;
function UpdateMountChoice() {
    const nPlayerId = Players.GetLocalPlayer();
    const loadoutChoices = Object.values(mountChoices[nPlayerId] || {});
    if (loadoutChoices.length === 0) {
        if (g_bMountSelectIsOpen) {
            g_bMountSelectIsOpen = false;
            Game.EmitSound("PenguinLoadout.Claim");
            $("#PenguinLoadoutContainer").RemoveClass("Visible");
            $("#PenguinLoadoutBackground").RemoveClass("Visible");
        }
        return;
    }
    const pList = $("#PenguinLoadoutList");
    pList.RemoveAndDeleteChildren();
    for (const sChoice of loadoutChoices) {
        const pItem = $.CreatePanel("Panel", pList, `PenguinLoadoutItem_${sChoice}`);
        pItem.BLoadLayoutSnippet("PenguinLoadoutItem");
        pItem.SwitchClass("Choice", sChoice);
        pItem.SetDialogVariableLocString("loadout_item_name", `#DOTA_HUD_mount_${sChoice}`);
        pItem.SetDialogVariableLocString("loadout_item_description", `#DOTA_HUD_mount_${sChoice}_description`);
        pItem.SetPanelEvent('onactivate', () => ChooseMount(sChoice));
    }
    if (!g_bMountSelectIsOpen) {
        g_bMountSelectIsOpen = true;
        $.Schedule(1.0, () => {
            Game.EmitSound("PenguinLoadout.Claim");
            $("#PenguinLoadoutContainer").AddClass("Visible");
            $("#PenguinLoadoutBackground").AddClass("Visible");
        });
    }
}
$.Schedule(0.5, UpdateMountChoice);
function FloatIcon(sChoice) {
    const pLoadoutItem = $(`#PenguinLoadoutItem_${sChoice}`);
    const pLoadoutIcon = pLoadoutItem.FindChildInLayoutFile("PenguinLoadoutIcon");
    const startRect = ObjectToMap(GetPanelRect(pLoadoutIcon));
    const pHud = $.GetContextPanel().FindAncestor("HUDElements");
    const pLowerHud = pHud.FindChild("lower_hud");
    const pSecondaryAbilities = pLowerHud.FindChildTraverse("SecondaryAbilityContainer");
    const pTartiaryAbilities = pSecondaryAbilities.FindChildTraverse("TertiaryAbilitiesBar");
    const pMountAbility = pTartiaryAbilities.FindChildTraverse("ConsumableAbility0");
    const endRect = ObjectToMap(GetPanelRect(pMountAbility));
    const pFloatingIcon = $("#PenguinLoadoutFloatingIcon");
    pFloatingIcon.SwitchClass("choice", sChoice);
    pFloatingIcon.RemoveClass("Hidden");
    function MoveIcon(curRect) {
        pFloatingIcon.SetPositionInPixels(curRect.get("x"), curRect.get("y"), 0);
        pFloatingIcon.style.height = curRect.get("height") + "px";
        pFloatingIcon.style.width = curRect.get("width") + "px";
    }
    InterpolateEveryFrame(0.6, startRect, endRect, MoveIcon, () => pFloatingIcon.AddClass("Hidden"));
}
function DebugFloatIcon() {
    const nPlayerId = Players.GetLocalPlayer();
    const loadoutChoices = Object.values(mountChoices[nPlayerId] || {});
    if (loadoutChoices.length > 0) {
        const sChoice = loadoutChoices[Math.floor(loadoutChoices.length * Math.random())];
        $.Msg(`DebugFloatIcon ${sChoice}`);
        FloatIcon(sChoice);
    }
    $.Schedule(3, DebugFloatIcon);
}
// $.Schedule( 3, DebugFloatIcon );
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ludGVyMjAyMl9tb3VudF9zZWxlY3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9kb3RhX2FkZG9ucy93aW50ZXIyMDIyL3Bhbm9yYW1hL3NjcmlwdHMvY3VzdG9tX2dhbWUvd2ludGVyMjAyMl9tb3VudF9zZWxlY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDJDQUEyQztBQUMzQyw2Q0FBNkM7QUFHN0MsTUFBTSxZQUFZLEdBQUcsdUJBQXVCLENBQWtCLGVBQWUsRUFBRSxpQkFBaUIsQ0FBRSxDQUFDO0FBRW5HLFNBQVMsV0FBVyxDQUFFLE9BQWU7SUFFakMsVUFBVSxDQUFDLDJCQUEyQixDQUFFLGNBQWMsRUFBRSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsQ0FBRSxDQUFDO0lBQzlFLFNBQVMsQ0FBRSxPQUFPLENBQUUsQ0FBQztBQUN6QixDQUFDO0FBRUQsSUFBSSxvQkFBb0IsR0FBRyxLQUFLLENBQUM7QUFDakMsU0FBUyxpQkFBaUI7SUFFdEIsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQzNDLE1BQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUUsWUFBWSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBRSxDQUFDO0lBQ3RFLElBQUssY0FBYyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQ2hDO1FBQ0ksSUFBSyxvQkFBb0IsRUFDekI7WUFDSSxvQkFBb0IsR0FBRyxLQUFLLENBQUM7WUFDN0IsSUFBSSxDQUFDLFNBQVMsQ0FBRSxzQkFBc0IsQ0FBRSxDQUFDO1lBQ3pDLENBQUMsQ0FBRSwwQkFBMEIsQ0FBRyxDQUFDLFdBQVcsQ0FBRSxTQUFTLENBQUUsQ0FBQztZQUMxRCxDQUFDLENBQUUsMkJBQTJCLENBQUcsQ0FBQyxXQUFXLENBQUUsU0FBUyxDQUFFLENBQUM7U0FDOUQ7UUFDRCxPQUFPO0tBQ1Y7SUFFRCxNQUFNLEtBQUssR0FBRyxDQUFD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